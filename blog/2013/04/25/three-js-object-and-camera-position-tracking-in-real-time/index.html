
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>three.js object and camera position tracking in real time - HTML5 Dev Gal</title>
  <meta name="author" content="Julia Jacobs">

  
  <meta name="description" content="In the “2D” world, you can inspect an element in a browser using the browser’s development tool (Firebug in Firefox, Chrome IE and Safari have their &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://html5devgal.com//blog/2013/04/25/three-js-object-and-camera-position-tracking-in-real-time/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="HTML5 Dev Gal" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">HTML5 Dev Gal</a></h1>
  
    <h2>Messing with HTML5, CSS3 and JavaScript.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:html5devgal.com/" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/portfolio.html">Portfolio</a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">three.js Object and Camera Position Tracking in Real Time</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-04-25T05:59:00-05:00" pubdate data-updated="true">Apr 25<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>In the “2D” world, you can inspect an element in a browser using the browser’s development
    tool (Firebug in Firefox, Chrome IE and Safari have their own) and view / tweak the css
    in realtime to move the element around.
In the CSS3D world this is <em>not</em> so easy.</p>

<p><!-- more --></p>

<p>The <a href="http://threejs.org/">three.js</a> library
is great in that it allows you to create objects, cameras, lights, etc. and position / animate
them (animating three.js objects can be achieved with <a href="https://raw.github.com/mrdoob/three.js/master/examples/js/libs/tween.min.js">tween.js</a>)
with x, y, and z coordinates.</p>

<h3 id="d-positioning">3D positioning</h3>
<p>Basically a 3D grid has an <strong><em>x plane</em></strong> (which is horizontal), a <strong><em>y plane</em></strong>
(which is vertical) and a <strong><em>z plane</em></strong> (which is depth)</p>

<p>An object with coordinates x=0, y=0 and z=0 is smack in the <strong><em>middle</em></strong> of this grid
 * A negative coordinate on the x plane will move an element left, positive to the right
 * A negative coordinate on the y plane will move an element down, positive will move it up
 * A negative coordinate on the z plane will move an element back, positive will move it forward</p>

<p><span class="caption-wrapper"><img class="caption" src="http://www.chromesphere.com/tutorials/other/Co-ordinates/xyz%20planes_full.png" width="" height="" alt="3D Grid" title="3D Grid" /><span class="caption-text">3D Grid</span></span></p>

<p>three.js has a <a href="https://raw.github.com/mrdoob/three.js/master/examples/js/renderers/CSS3DRenderer.js">CSS3D renderer</a>
which, magically using some very heavy matrix equations, dynamically translates x, y and z
coordinates into a css property called -webkit-transform whose values usually look like this monstrosity:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class=""><span class="line">-webkit-transform:
</span><span class="line">   translate3d(0px, 0px, 473.7224230277783px)
</span><span class="line">   matrix3d(
</span><span class="line">      0.9999499917030334, 0, -0.009999499656260014, 0,
</span><span class="line">      0, -1, 0, 0,
</span><span class="line">      0.009999499656260014, 0, 0.9999499917030334, 0,
</span><span class="line">      0.000002216018401668407, 0, -4987.5380859375, 1
</span><span class="line">   )
</span><span class="line">   translate3d(747.5px, 363.5px, 0px);</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Yick.</p>

<p>For more somewhat understandable info on matrix3d, <a href="http://9elements.com/html5demos/matrix3d/">this</a>
is probably the best documentation out there.</p>

<p>So how are you supposed to figure out the position of a camera in real time after you’ve zoomed into your app?</p>

<p>Say you want an event to fire off when the camera is close to a certain object? Or an event to
fire off only if you click on objects located in a certain z-plane coordinate?
###Tracking Objects
Say you’ve got an object element with the following css:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class=""><span class="line">-webkit-transform:
</span><span class="line"> translate3d(-50%, -50%, 0px)
</span><span class="line"> matrix3d(
</span><span class="line"> 1, 0, 0, 0,
</span><span class="line"> 0, -1, 0, 0,
</span><span class="line"> 0, 0, 1, 0,
</span><span class="line"> -800, 800, 3500, 1
</span><span class="line"> );</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong><em>All you really care about as far as tracking the x, y and z coordinates
            of the object’s element is the 13th, 14th and 15th values: -800, 800, 3500.</em></strong></p>

<p><span class="caption-wrapper"><img class="caption" src="/images/att-html5-u-verse-poc.png" width="" height="" alt="Object" title="Object" /><span class="caption-text">Object</span></span></p>

<p>So by viewing these coordinates we know where the object is!</p>

<p>This comes in <em>**VERY **</em>handy when tracking the camera position during navigation.</p>

<h3 id="tracking-the-camera">Tracking The Camera</h3>
<p>The camera position can be found in the second child of whatever element is defined as the ‘container’ of the scene.</p>

<p>In this example this element has an id of ‘video_container’.</p>

<p>Here’s the JavaScript code to illustrate adding a scene to an element container:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="javascript"><span class="line"><span class="kd">var</span> <span class="nx">camera</span><span class="p">,</span> <span class="nx">scene</span><span class="p">,</span> <span class="nx">renderer</span><span class="p">,</span> <span class="nx">controls</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="nx">camera</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">PerspectiveCamera</span><span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span> <span class="o">/</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">5000</span><span class="p">);</span>
</span><span class="line"><span class="c1">// camera is center &amp; &#39;front&#39; or screen - camera coordinates are opposite to object coordinates</span>
</span><span class="line"><span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">;</span> <span class="c1">// lower the number &#39;closer&#39; to objects</span>
</span><span class="line"><span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">25</span><span class="p">;</span> <span class="c1">// lower the number more to the right</span>
</span><span class="line"><span class="nx">camera</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// lower the number the more up</span>
</span><span class="line"><span class="nx">scene</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Scene</span><span class="p">();</span>
</span><span class="line"><span class="c1">// CSS3D renderer</span>
</span><span class="line"><span class="nx">renderer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">CSS3DRenderer</span><span class="p">();</span>
</span><span class="line"><span class="nx">renderer</span><span class="p">.</span><span class="nx">setSize</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">innerWidth</span><span class="p">,</span> <span class="nb">window</span><span class="p">.</span><span class="nx">innerHeight</span><span class="p">);</span>
</span><span class="line"><span class="nx">renderer</span><span class="p">.</span><span class="nx">domElement</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="s1">&#39;absolute&#39;</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;video_container&#39;</span><span class="p">).</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">domElement</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Here’s the element in the markup, shown in Chrome’s Developer Tools:</p>

<p><span class="caption-wrapper"><img class="caption" src="/images/cameraobject.png" width="" height="" alt="Chrome Developer Tools" title="Chrome Developer Tools" /><span class="caption-text">Chrome Developer Tools</span></span></p>

<p>Here’s the CSS matrix3D values:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class=""><span class="line">-webkit-transform:
</span><span class="line">   translate3d(0px, 0px, 445.70307751169236px)
</span><span class="line">   matrix3d(
</span><span class="line">      0.9999875426292419, 0, -0.004999937489628792,
</span><span class="line">      0, 0, -1,
</span><span class="line">      0, 0, 0.004999937489628792,
</span><span class="line">      0, 0.9999875426292419, 0,
</span><span class="line">      0, 0, -5000.0625, 1
</span><span class="line">   )
</span><span class="line">   translate3d(747.5px, 342px, 0px);</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>As you can see the camera coordinates in the JavaScript code shows z = 5000,
but in the css z = -5000.0625, a <strong><em>NEGATIVE</em></strong> value.</p>

<p>What gives?</p>

<p>Because the camera is ‘facing’ <strong><em>toward</em></strong> the grid and the objects in the grid,
the negative and positive values of the x, y, and z coordinates are OPPOSITE of the actual grid and objects.
So the way it works in the three.js library is:
 * +x moves the camera to the LEFT of the grid whereas -z moves the camera to the RIGHT
 * +y moves the camera DOWN in the grid whereas -z moves the camera UP
 * +z moves the camera AWAY from the grid whereas -z moves the camera CLOSER</p>

<p><strong><em>UPDATE</em></strong>
I just was honored with a tweet from the great Ricardo Cabello Miguel aka <a href="http://www.mrdoob.com/">mr.doob</a>,
creator of three.js, about a better way to get the cameras position in relationship to an object:</p>

<div class="embed tweet"><blockquote class="twitter-tweet"><p><a href="https://twitter.com/jewelsjacobs">@jewelsjacobs</a> I think you are making things harder than they are&#8230; why not just camera.position.distanceTo( object.position )?</p>&mdash; Mr.d ͡° ͜ʖ ͡°b (@mrdoob) <a href="https://twitter.com/mrdoob/statuses/327555248531050497">April 25, 2013</a></blockquote>
<script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script></div>

<p>Unfortunately, I can’t really use this for realtime results during navigation
because my camera and object position code is in global variables in a different
files order to make things more modular.
Setting breakpoints in the browser or
entering it in the console isn’t quote working for me. To just get the camera z-plane
value in the browser console check out
  <a href="/blog/2013/05/01/trick-to-get-three-js-camera-z-plane-value-in-browser-development-tools-console/">this post</a></p>

<p><strong><em>AN IMPORTANT NOTE ABOUT TRACKBALL / TOUCH CONTROLS AND THE CAMERA Z POSITION:</em></strong>
To facilitate scroll wheel, trackball and touch zoom controls, a three.js utility
library
called <a href="https://raw.github.com/mrdoob/three.js/master/examples/js/controls/TrackballControls.js">Trackball Controls</a>
can be used.
Make sure all of your objects have <strong><em>POSITIVE</em></strong> z coordinate values.
If they don’t the camera will never reach them as it can only zoom up to
z coordinate = 0. Once the camera has z = 0 you will keep pinching / scrolling forever and go no where.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Julia Jacobs</span></span>

      








  


<time datetime="2013-04-25T05:59:00-05:00" pubdate data-updated="true">Apr 25<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/3d-ui/'>3D UI</a>, <a class='category' href='/blog/categories/css3d/'>CSS3D</a>, <a class='category' href='/blog/categories/html5/'>HTML5</a>, <a class='category' href='/blog/categories/css/'>css</a>, <a class='category' href='/blog/categories/javascript/'>javaScript</a>, <a class='category' href='/blog/categories/three-dot-js/'>three.js</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://html5devgal.com//blog/2013/04/25/three-js-object-and-camera-position-tracking-in-real-time/" data-via="jewelsjacobs" data-counturl="http://html5devgal.com//blog/2013/04/25/three-js-object-and-camera-position-tracking-in-real-time/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
      
        <a class="basic-alignment right" href="/blog/2013/05/01/career-tips-for-javascript-developers/" title="Next Post: Career Tips for JavaScript Developers">Career Tips for JavaScript Developers &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
<script src="//about.me/embed/juliajacobs"></script>
</section>
<section>
  <h1>Stack Overflow</h1>
<a href="http://stackoverflow.com/users/2069937/jewelsjacobs">
<img src="http://stackoverflow.com/users/flair/2069937.png" width="208" height="58" alt="profile for jewelsjacobs at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for jewelsjacobs at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
</a>
  </section><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/06/05/automatic-javascript-linting-fixes/">Automatic JavaScript Linting Fixes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/29/vertically-and-horizontally-center-with-twitter-bootstrap-responsive/">Vertically and Horizontally Center With Twitter Bootstrap (Responsive)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/24/dynamic-namespace-objects-based-on-directory-structure-and-file-names/">Dynamic Namespace Objects Based On Directory Structure and File Names</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/16/my-two-new-jquery-plugins-and-one-new-node-module/">My Two New jQuery Plugins and One New Node Module</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/16/create-dynamic-namespace-autoloader-with-node-js-express-walk-and-titlecaps/">Create Dynamic Namespace Autoloader With Node.js, Express, and Walk</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/jewelsjacobs">@jewelsjacobs</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'jewelsjacobs',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/jjacobs2000@me.com?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>


<section>
 <h1>Twitter</h1>
<a class="twitter-timeline" href="https://twitter.com/jewelsjacobs" data-widget-id="342412177384280064">Tweets by @jewelsjacobs</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Julia Jacobs -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a>. Design by <a href="http://octopressthemes.com">Octopress Themes</a>. Background image by <a href="http://www.flickr.com/photos/joeshlabotnik/">Josh Shlabotnik</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
